<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <!--[if lt IE 9]>
            <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
        <![endif]-->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="robots" content="index, follow, all" />
        <meta name="Author" content="Extreme Sensio" />
        <meta name="Language" content="en"/>
        <meta name="Copyright" content="Sensio Labs" />
        <meta name="Publisher" content="Sensio Labs" />
        <meta name="Description" content="Symfony - Open-Source PHP web framework" />
        <meta name="Keywords" content="symfony2, symfony, project, framework, php, php5, open-source, components, symphony, symfony framework, symfony tutorial" />

        <link rel="search" type="application/opensearchdescription+xml" href="http://symfony.com/opensearch/documentation.xml" title="Symfony2 documentation" />

        <title>Testing (current) - Symfony</title>

                        <link rel="stylesheet" href="/css/compiled/all.css?v=3" />
                 <link href="https://connect.sensiolabs.com/css/sln.css" rel="stylesheet" type="text/css" media="all" />

                
                
                    <script type="text/javascript" src="/js/all.js?v=3"></script>
        
                
        <!--[if lt IE 9]>
          <script src="/js/common/html5.js" type="text/javascript"></script>
        <![endif]-->

        <!--[if IE 6]>
            <script src="/js/common/DD_belatedPNG_0.0.7a-min.js" type="text/javascript"></script>
            <script src="/js/common/ExtendDD_belatedPNG_0.0.7a.js" type="text/javascript"></script>
            <script type="text/javascript">
                DD_belatedPNG.fix('.png_fix');
            </script>
        <![endif]-->

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-89393-6']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
    </head>

    <body>
        <div id="content_wrapper" class="">
            <div id="sln"></div>

            <div class="content">
                

    
<div class="header">
    <div class="content_header clear_fix">
        <div class="illustration_logo_header">
                            <a href="/"><img src="/images/common/logo/logo_symfony_header.png" alt="Symfony" class="png_fix" /></a>
                    </div>
        <div class="box_download clear_fix">
            <div class="legend_download">
                <img src="/images/en/a_sensiolabs_product.png" alt="a SensioLabs product" class="png_fix" />
            </div>
            <div class="download_button_wrapper">
                <a href="/download" class="download_button">    <span class="border_l png_fix">
        <span class="border_r png_fix">
            <span class="btn_bg png_fix">
                DOWNLOAD NOW
            </span>
        </span>
    </span>
</a>
            </div>
        </div>
    </div>
</div>

<div class="main_menu clear_fix" id="main_menu_id">
    <ul class="clear_fix">
        <li class="first what_is_symfony"><a href="/what-is-symfony">What is Symfony?</a></li>
        <li class="get_started">
            <a href="/get_started">Get started</a>
                    </li>
        <li class="learn selected"><a href="/doc/current/index.html">Documentation</a></li>
        <li class="community"><a href="/community">Community</a></li>
        <li class="services"><a href="/services">Services</a></li>
        <li class="blog">
            <a href="/blog/">News</a>
            <div class="box_dropdown_wrapper">
    <div class="border_l">
        <div class="middle_border_l">
            <div class="border_r">
                <div class="middle_border_r">
                    <div class="content_wrapper">
                        <div class="box_content">
                                <div class="inner_drop_box_two_columns clear_fix">
        <div class="inner_drop_box_two_columns_column_01">
            <h2 class="dropdown_title">
                <div class="button"><a href="http://twitter.com/symfony" title="twitter account"><img style="width: 35px; margin-top: -10px" src="/images/common/picto/twitter.png" alt="Twitter" /></a></div>
                <div class="button"><a href="http://feeds.feedburner.com/symfony/blog" title="blog feed"><img src="/images/common/picto/rss.gif" alt="feed" /></a></div>
                <a href="/blog/">Latest News</a>
            </h2>

            <div class="box_article post">
                    <div class="gravatar"><a href="https://connect.sensiolabs.com/api/alternates/4aed4f5d-e0cb-4320-902f-885fddaa7d15"><img width="57" height="57" src="https://connect.sensiolabs.com/api/images/4aed4f5d-e0cb-4320-902f-885fddaa7d15.png?format=57x57" alt="Fabien Potencier"></a></div>
                <h3 class="title_05"><a href="/blog/symfony-2-3-schedule-update">Symfony 2.3 schedule update</a></h3>
                <div class="complementaries_informations">
    by
            <a href="https://connect.sensiolabs.com/api/alternates/4aed4f5d-e0cb-4320-902f-885fddaa7d15">Fabien Potencier</a>
            – April 30, 2013
        </div>
            </div>

                <div class="box_hr"><hr /></div>


            <div class="box_article">
                <h2 class="title_05"><a href="/blog/a-week-of-symfony-330-22-28-april-2013">What happened last week in Symfony?</a></h2>
                <p>This week, it was announced that the Symfony 2.3 Standard Edition will only include MIT/BSD licensed libraries and bundles (<a href="https://github.com/symfony/symfony-standard/pull/535">view pull request</a>). In addition, Symfony 2.3 <a href="http://twitter.com/fabpot/status/327525715903905793">was declared nearly completed</a>, with just a few important PR remaining before the first beta version. Lastly, a new version of <a href="http://desktop.sensiolabs.org/">SensioLabs Desktop</a> was released.</p>
            </div>
        </div>
        <div class="inner_drop_box_two_columns_column_02">
            <h2 class="dropdown_title">
                <div class="button"><a href="http://twitter.com/symfony" title="twitter account"><img style="width: 35px; margin-top: -10px" src="/images/common/picto/twitter.png" alt="Twitter" /></a></div>
                <div class="button"><a href="http://feeds.feedburner.com/symfony/events" title="events rss"><img src="/images/common/picto/rss.gif" alt="RSS" /></a></div>
                <a href="/events/">Upcoming Events</a>
            </h2>

            <div class="box_article">
                <p>The Symfony Community organizes events all over the world on a regular basis. Here are the next ones.</p>
                                                            <h2 class="title_05">
                            <img src="/images/flags/de.png?v=3" />
                                                            <a href="http://www.meetup.com/sfugmd/events/113619892/">Germany, Gera &mdash; Symfony User Group Mitteldeutschland Treffen</a>
                                                    </h2>
                        <div class="event_detail">
                                                            on May 08, 2013, from 19:00 to 20:30
                                                    </div>
                                            <h2 class="title_05">
                            <img src="/images/flags/de.png?v=3" />
                                                            <a href="http://www.meetup.com/sfugcgn/events/104715432/">Germany, Köln &mdash; Treffen der Symfony User Group Cologne</a>
                                                    </h2>
                        <div class="event_detail">
                                                            on May 08, 2013, from 19:30 to 21:00
                                                    </div>
                                            <h2 class="title_05">
                            <img src="/images/flags/fr.png?v=3" />
                                                            <a href="http://sfpotparismai2013.eventbrite.fr/">France, Paris &mdash; sfPot Paris Mai - Formulaire et Tests</a>
                                                    </h2>
                        <div class="event_detail">
                                                            on May 14, 2013, from 19:30 to 21:00
                                                    </div>
                                            <h2 class="title_05">
                            <img src="/images/flags/us.png?v=3" />
                                                            <a href="http://portland2013.live.symfony.com/">United States, Portland &mdash; SymfonyLive Portland 2013</a>
                                                    </h2>
                        <div class="event_detail">
                                                            from May 20, 2013 to May 24, 2013
                                                    </div>
                                                </div>
        </div>
    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="bottom">
        <div class="corner_l">
            <div class="corner_r">
                <div class="border"></div>
            </div>
        </div>
    </div>
</div>
        </li>
        <li class="last about"><a href="/about">About</a></li>
    </ul>
</div>

                                    <div class="main_content">
                                                    <div class="box_columns clear_fix">
                                                                                                            <div class="column_01">
                                                                                            <div class="submenu">
                                                    <ul class="list_submenu">    <li class="first selected"><a href="/doc/current/book/index.html">The Book</a></li>
<li><a href="/doc/current/cookbook/index.html">The Cookbook</a></li>
<li><a href="/doc/current/components/index.html">The Components</a></li>
<li><a href="/doc/current/reference/index.html">Reference</a></li>
<li><a href="/doc/current/glossary.html">Glossary</a></li>
<li><a href="/doc/current/genindex.html">Index</a></li>
<li><a href="/doc/current/bundles/index.html">Bundles</a></li>
<li><a href="/doc/master/cmf/index.html">Symfony CMF</a></li>
<li><a href="/doc/master/contributing/code/security.html#security-advisories">Security Advisories</a></li>
<li><a href="/legacy/doc">Docs for symfony 1.x</a></li>
<li><a href="/doc/current/contributing/index.html">Contributing</a></li>
<li><a href="/talks">Talks</a></li>
<li><a href="http://trainings.sensiolabs.com/">Trainings</a></li>
<li class="last"><a href="http://books.sensiolabs.com">Books</a></li>
</ul>
                                                </div>
                                                                        <div class="toc">
                <h2 class="title_05">Table of Contents</h2>
                <div class="toc-content">
                    <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#the-phpunit-testing-framework">The PHPUnit Testing Framework</a></li>
<li><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li><a class="reference internal" href="#functional-tests">Functional Tests</a><ul>
<li><a class="reference internal" href="#your-first-functional-test">Your First Functional Test</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-the-test-client">Working with the Test Client</a><ul>
<li><a class="reference internal" href="#browsing">Browsing</a></li>
<li><a class="reference internal" href="#accessing-internal-objects">Accessing Internal Objects</a></li>
<li><a class="reference internal" href="#accessing-the-container">Accessing the Container</a></li>
<li><a class="reference internal" href="#accessing-the-profiler-data">Accessing the Profiler Data</a></li>
<li><a class="reference internal" href="#redirecting">Redirecting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-crawler">The Crawler</a><ul>
<li><a class="reference internal" href="#traversing">Traversing</a></li>
<li><a class="reference internal" href="#extracting-information">Extracting Information</a></li>
<li><a class="reference internal" href="#links">Links</a></li>
<li><a class="reference internal" href="#forms">Forms</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-configuration">Testing Configuration</a><ul>
<li><a class="reference internal" href="#phpunit-configuration">PHPUnit Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#learn-more">Learn more</a></li>
</ul>
</li>
</ul>

                </div>
            </div>
            
    <div class="feedback">
    <h2 class="title_05">Questions &amp; Feedback</h2>
    <p>
      <em>Found a typo or an error?</em><br />
      <em>Want to improve this document?</em> <a href="https://github.com/symfony/symfony-docs/edit/2.2/book/testing.rst">Edit</a> it.
    </p>
    <p>
      <em>Need support or have a technical question?</em><br />
      Post to the <a href="http://groups.google.com/group/symfony2">user mailing-list</a>.
     </p>
</div>
    <div id="license">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
        <img alt="Creative Commons License" src="http://symfony.com/images/license.png" />
    </a>
    <div>
        This <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/MovingImage" rel="dc:type">work</span> is licensed under a
        <br />
        Creative Commons
        <br />
        Attribution-Share Alike 3.0
        <br />
        Unported <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">License</a>.
    </div>
</div>
                                                                                                    
<div class="ads">
        <div class="box_hr"><hr /></div>


            <div class="ad" id="ad_trainings_1">
            <h3><a href="http://trainings.sensiolabs.com/en/training/getting-started-with-symfony2">Master Symfony2 fundamentals</a></h3>
            <div>Be trained by SensioLabs experts (2 to 6 day sessions -- French or English).</div>
            <div><cite>trainings.sensiolabs.com</cite></div>
        </div>
            <div class="ad" id="ad_servergrove_1">
            <h3><a href="http://symfony.com/servergrove">Symfony hosting done right</a></h3>
            <div>ServerGrove, outstanding support at the right price for your Symfony hosting needs.</div>
            <div><cite>servergrove.com</cite></div>
        </div>
            <div class="ad" id="ad_support_1">
            <h3><a href="http://sensiolabs.com/en/support/sensiolabs_support.html">Discover the SensioLabs Support</a></h3>
            <div>Access to the SensioLabs Competency Center for an exclusive and tailor-made support on Symfony</div>
            <div><cite>sensiolabs.com</cite></div>
        </div>
    </div>

<script type="text/javascript">
    $(document).ready(function () {
                    $("#ad_trainings_1").click(function () { _gaq.push(['_trackEvent', 'Ads', 'Ads', 'trainings_1']); });
                    $("#ad_servergrove_1").click(function () { _gaq.push(['_trackEvent', 'Ads', 'Ads', 'servergrove_1']); });
                    $("#ad_support_1").click(function () { _gaq.push(['_trackEvent', 'Ads', 'Ads', 'support_1']); });
            });
</script>
                                                                                                                                                    <div class="ads">
                                                        <a href="https://connect.sensiolabs.com/"><img src="/images/sensiolabs_connect.png?v=3" /></a>
                                                    </div>
                                                                                                                                    </div>
                                                                        <div class="column_02">
                                                                                    <div class="breadcrumb">
                                                <a href="/">Home</a> &raquo;
                                                            <a href="/doc/current/index.html">Documentation</a> &raquo;
    
            <a href="index.html" accesskey="U">The Book</a> &raquo;
    
    Testing
                                            </div>

                                                                                                <div class="box_title">
                                                        <div class="box_version_wrapper">
        <div class="version_wrapper">
            <div class="version">
                2.2 version
                <span class="arrow">
                    <img src="/images/common/picto/down_arrow_white.png" alt="" />
                </span>
            </div>
            <div class="other_version">
                                    <ul>
                                                                                    <li>
                                    <a href="/doc/2.0/book/testing.html">2.0 version</a>
                                </li>
                                                                                                                <li>
                                    <a href="/doc/2.1/book/testing.html">2.1 version</a>
                                </li>
                                                                                                                                                                    <li>
                                    <a href="/doc/master/book/testing.html">master version</a>
                                </li>
                                                                        </ul>
                                                                            <hr />
                                        <ul>
                                                                                    <li>
                                    <a href="/fr/doc/current/book/testing.html">French</a>
                                </li>
                                                                                                                <li>
                                    <a href="/it/doc/current/book/testing.html">Italian</a>
                                </li>
                                                                        </ul>
                            </div>
        </div>
    </div>
                                                    <h1 class="title_01">Testing</h1>
                                                </div>
                                            
        
                                                
    <div class="box_article doc_page">
        <div class="section" id="testing">
<span id="index-0"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>Whenever you write a new line of code, you also potentially add new bugs.
To build better and more reliable applications, you should test your code
using both functional and unit tests.</p>
<div class="section" id="the-phpunit-testing-framework">
<h2>The PHPUnit Testing Framework<a class="headerlink" href="#the-phpunit-testing-framework" title="Permalink to this headline">¶</a></h2>
<p>Symfony2 integrates with an independent library - called PHPUnit - to give
you a rich testing framework. This chapter won't cover PHPUnit itself, but
it has its own excellent <a class="reference external" href="http://www.phpunit.de/manual/3.5/en/">documentation</a>.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Symfony2 works with PHPUnit 3.5.11 or later, though version 3.6.4 is
needed to test the Symfony core code itself.</p>
</div></div>
<p>Each test - whether it's a unit test or a functional test - is a PHP class
that should live in the <cite>Tests/</cite> subdirectory of your bundles. If you follow
this rule, then you can run all of your application's tests with the following
command:</p>
<div class="literal-block"><div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># specify the configuration directory on the command line</span>
<span class="nv">$ </span>phpunit -c app/
</pre></div>
</td></tr></table></div></div>
<p>The <tt class="docutils literal"><code>-c</code></tt> option tells PHPUnit to look in the <tt class="docutils literal"><code>app/</code></tt> directory for a configuration
file. If you're curious about the PHPUnit options, check out the <tt class="docutils literal"><code>app/phpunit.xml.dist</code></tt>
file.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Code coverage can be generated with the <tt class="docutils literal"><code>--coverage-html</code></tt> option.</p>
</div></div>
</div>
<div class="section" id="unit-tests">
<span id="index-1"></span><h2>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h2>
<p>A unit test is usually a test against a specific PHP class. If you want to
test the overall behavior of your application, see the section about <a class="reference internal" href="#functional-tests">Functional Tests</a>.</p>
<p>Writing Symfony2 unit tests is no different than writing standard PHPUnit
unit tests. Suppose, for example, that you have an <em>incredibly</em> simple class
called <tt class="docutils literal"><code>Calculator</code></tt> in the <tt class="docutils literal"><code>Utility/</code></tt> directory of your bundle:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// src/Acme/DemoBundle/Utility/Calculator.php</span>
<span class="k">namespace</span> <span class="nx">Acme\DemoBundle\Utility</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Calculator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>To test this, create a <tt class="docutils literal"><code>CalculatorTest</code></tt> file in the <tt class="docutils literal"><code>Tests/Utility</code></tt> directory
of your bundle:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// src/Acme/DemoBundle/Tests/Utility/CalculatorTest.php</span>
<span class="k">namespace</span> <span class="nx">Acme\DemoBundle\Tests\Utility</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Acme\DemoBundle\Utility\Calculator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CalculatorTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$calc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Calculator</span><span class="p">();</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$calc</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>

        <span class="c1">// assert that your calculator added the numbers correctly!</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">By convention, the <tt class="docutils literal"><code>Tests/</code></tt> sub-directory should replicate the directory
of your bundle. So, if you're testing a class in your bundle's <tt class="docutils literal"><code>Utility/</code></tt>
directory, put the test in the <tt class="docutils literal"><code>Tests/Utility/</code></tt> directory.</p>
</div></div>
<p>Just like in your real application - autoloading is automatically enabled
via the <tt class="docutils literal"><code>bootstrap.php.cache</code></tt> file (as configured by default in the <tt class="docutils literal"><code>phpunit.xml.dist</code></tt>
file).</p>
<p>Running tests for a given file or directory is also very easy:</p>
<div class="literal-block"><div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># run all tests in the Utility directory</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/Tests/Utility/

<span class="c"># run tests for the Calculator class</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/Tests/Utility/CalculatorTest.php

<span class="c"># run all tests for the entire Bundle</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="functional-tests">
<span id="index-2"></span><h2>Functional Tests<a class="headerlink" href="#functional-tests" title="Permalink to this headline">¶</a></h2>
<p>Functional tests check the integration of the different layers of an
application (from the routing to the views). They are no different from unit
tests as far as PHPUnit is concerned, but they have a very specific workflow:</p>
<ul class="simple">
<li>Make a request;</li>
<li>Test the response;</li>
<li>Click on a link or submit a form;</li>
<li>Test the response;</li>
<li>Rinse and repeat.</li>
</ul>
<div class="section" id="your-first-functional-test">
<h3>Your First Functional Test<a class="headerlink" href="#your-first-functional-test" title="Permalink to this headline">¶</a></h3>
<p>Functional tests are simple PHP files that typically live in the <tt class="docutils literal"><code>Tests/Controller</code></tt>
directory of your bundle. If you want to test the pages handled by your
<tt class="docutils literal"><code>DemoController</code></tt> class, start by creating a new <tt class="docutils literal"><code>DemoControllerTest.php</code></tt>
file that extends a special <tt class="docutils literal"><code>WebTestCase</code></tt> class.</p>
<p>For example, the Symfony2 Standard Edition provides a simple functional test
for its <tt class="docutils literal"><code>DemoController</code></tt> (<a class="reference external" href="https://github.com/symfony/symfony-standard/blob/master/src/Acme/DemoBundle/Tests/Controller/DemoControllerTest.php">DemoControllerTest</a>) that reads as follows:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// src/Acme/DemoBundle/Tests/Controller/DemoControllerTest.php</span>
<span class="k">namespace</span> <span class="nx">Acme\DemoBundle\Tests\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Test\WebTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DemoControllerTest</span> <span class="k">extends</span> <span class="nx">WebTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">();</span>

        <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/demo/hello/Fabien&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertGreaterThan</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;html:contains(&quot;Hello Fabien&quot;)&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p>To run your functional tests, the <tt class="docutils literal"><code>WebTestCase</code></tt> class bootstraps the
kernel of your application. In most cases, this happens automatically.
However, if your kernel is in a non-standard directory, you'll need
to modify your <tt class="docutils literal"><code>phpunit.xml.dist</code></tt> file to set the <tt class="docutils literal"><code>KERNEL_DIR</code></tt> environment
variable to the directory of your kernel:</p>
<div class="literal-block"><div class="last highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;phpunit&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;php&gt;</span>
        <span class="nt">&lt;server</span> <span class="na">name=</span><span class="s">&quot;KERNEL_DIR&quot;</span> <span class="na">value=</span><span class="s">&quot;/path/to/your/app/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
<p>The <tt class="docutils literal"><code>createClient()</code></tt> method returns a client, which is like a browser that
you'll use to crawl your site:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/demo/hello/Fabien&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>The <tt class="docutils literal"><code>request()</code></tt> method (see <a class="reference internal" href="#book-testing-request-method-sidebar"><em>more about the request method</em></a>)
returns a <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/2.2/Symfony/Component/DomCrawler/Crawler.html" title="Symfony\Component\DomCrawler\Crawler">Crawler</a></code></tt> object which can
be used to select elements in the Response, click on links, and submit forms.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">The Crawler only works when the response is an XML or an HTML document.
To get the raw content response, call <tt class="docutils literal"><code>$client-&gt;getResponse()-&gt;getContent()</code></tt>.</p>
</div></div>
<p>Click on a link by first selecting it with the Crawler using either an XPath
expression or a CSS selector, then use the Client to click on it. For example,
the following code finds all links with the text <tt class="docutils literal"><code>Greet</code></tt>, then selects
the second one, and ultimately clicks on it:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;a:contains(&quot;Greet&quot;)&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Submitting a form is very similar; select a form button, optionally override
some form values, and submit the corresponding form:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectButton</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>

<span class="c1">// set some values</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Lucas&#39;</span><span class="p">;</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;form_name[subject]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Hey there!&#39;</span><span class="p">;</span>

<span class="c1">// submit the form</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">The form can also handle uploads and contains methods to fill in different types
of form fields (e.g. <tt class="docutils literal"><code>select()</code></tt> and <tt class="docutils literal"><code>tick()</code></tt>). For details, see the
<a class="reference internal" href="#forms">Forms</a> section below.</p>
</div></div>
<p>Now that you can easily navigate through an application, use assertions to test
that it actually does what you expect it to. Use the Crawler to make assertions
on the DOM:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// Assert that the response matches a given CSS selector.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertGreaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
<p>Or, test against the Response content directly if you just want to assert that
the content contains some text, or if the Response is not an XML/HTML
document:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRegExp</span><span class="p">(</span>
    <span class="s1">&#39;/Hello Fabien/&#39;</span><span class="p">,</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper" id="book-testing-request-method-sidebar">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title">More about the <tt class="docutils literal"><code>request()</code></tt> method:</p>
<p>The full signature of the <tt class="docutils literal"><code>request()</code></tt> method is:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">request</span><span class="p">(</span>
    <span class="nv">$method</span><span class="p">,</span>
    <span class="nv">$uri</span><span class="p">,</span>
    <span class="k">array</span> <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$server</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="nv">$changeHistory</span> <span class="o">=</span> <span class="k">true</span>
<span class="p">)</span>
</pre></div>
</td></tr></table></div></div>
<p>The <tt class="docutils literal"><code>server</code></tt> array is the raw values that you'd expect to normally
find in the PHP <a class="reference external" href="http://php.net/manual/en/reserved.variables.server.php">$_SERVER</a> superglobal. For example, to set the <cite>Content-Type</cite>,
<cite>Referer</cite> and <cite>X-Requested-With' HTTP headers, you'd pass the following (mind
the `HTTP_</cite> prefix for non standard headers):</p>
<div class="literal-block"><div class="last highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/demo/hello/Fabien&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;CONTENT_TYPE&#39;</span>          <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HTTP_REFERER&#39;</span>          <span class="o">=&gt;</span> <span class="s1">&#39;/foo/bar&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HTTP_X-Requested-With&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;XMLHttpRequest&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
<div class="admonition-wrapper" id="index-3">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title">Useful Assertions</p>
<p>To get you started faster, here is a list of the most common and
useful test assertions:</p>
<div class="literal-block"><div class="last highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// Assert that there is at least one h2 tag</span>
<span class="c1">// with the class &quot;subtitle&quot;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertGreaterThan</span><span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h2.subtitle&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span>
<span class="p">);</span>

<span class="c1">// Assert that there are exactly 4 h2 tags on the page</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">));</span>

<span class="c1">// Assert that the &quot;Content-Type&quot; header is &quot;application/json&quot;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">contains</span><span class="p">(</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;application/json&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Assert that the response content matches a regexp.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRegExp</span><span class="p">(</span><span class="s1">&#39;/foo/&#39;</span><span class="p">,</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">());</span>

<span class="c1">// Assert that the response status code is 2xx</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isSuccessful</span><span class="p">());</span>
<span class="c1">// Assert that the response status code is 404</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isNotFound</span><span class="p">());</span>
<span class="c1">// Assert a specific 200 status code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
    <span class="mi">200</span><span class="p">,</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span>
<span class="p">);</span>

<span class="c1">// Assert that the response is a redirect to /demo/contact</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isRedirect</span><span class="p">(</span><span class="s1">&#39;/demo/contact&#39;</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">// or simply check that the response is a redirect to any URL</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isRedirect</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
</div>
</div>
<div class="section" id="working-with-the-test-client">
<span id="index-4"></span><h2>Working with the Test Client<a class="headerlink" href="#working-with-the-test-client" title="Permalink to this headline">¶</a></h2>
<p>The Test Client simulates an HTTP client like a browser and makes requests
into your Symfony2 application:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/hello/Fabien&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>The <tt class="docutils literal"><code>request()</code></tt> method takes the HTTP method and a URL as arguments and
returns a <tt class="docutils literal"><code>Crawler</code></tt> instance.</p>
<p>Use the Crawler to find DOM elements in the Response. These elements can then
be used to click on links and submit forms:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Go elsewhere...&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

<span class="nv">$form</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectButton</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>The <tt class="docutils literal"><code>click()</code></tt> and <tt class="docutils literal"><code>submit()</code></tt> methods both return a <tt class="docutils literal"><code>Crawler</code></tt> object.
These methods are the best way to browse your application as it takes care
of a lot of things for you, like detecting the HTTP method from a form and
giving you a nice API for uploading files.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">You will learn more about the <tt class="docutils literal"><code>Link</code></tt> and <tt class="docutils literal"><code>Form</code></tt> objects in the
<a class="reference internal" href="#book-testing-crawler"><em>Crawler</em></a> section below.</p>
</div></div>
<p>The <tt class="docutils literal"><code>request</code></tt> method can also be used to simulate form submissions directly
or perform more complex requests:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// Directly submit a form (but using the Crawler is easier!)</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/submit&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>

<span class="c1">// Submit a raw JSON string in the request body</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/submit&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">),</span>
    <span class="s1">&#39;{&quot;name&quot;:&quot;Fabien&quot;}&#39;</span>
<span class="p">);</span>

<span class="c1">// Form submission with a file upload</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>

<span class="nv">$photo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UploadedFile</span><span class="p">(</span>
    <span class="s1">&#39;/path/to/photo.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span>
    <span class="mi">123</span>
<span class="p">);</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/submit&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span> <span class="o">=&gt;</span> <span class="nv">$photo</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Perform a DELETE requests, and pass HTTP headers</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/post/12&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;PHP_AUTH_USER&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;PHP_AUTH_PW&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pa$$word&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Last but not least, you can force each request to be executed in its own PHP
process to avoid any side-effects when working with several clients in the same
script:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">insulate</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<div class="section" id="browsing">
<h3>Browsing<a class="headerlink" href="#browsing" title="Permalink to this headline">¶</a></h3>
<p>The Client supports many operations that can be done in a real browser:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">back</span><span class="p">();</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">();</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">reload</span><span class="p">();</span>

<span class="c1">// Clears all cookies and the history</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">restart</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="accessing-internal-objects">
<h3>Accessing Internal Objects<a class="headerlink" href="#accessing-internal-objects" title="Permalink to this headline">¶</a></h3>
<p>If you use the client to test your application, you might want to access the
client's internal objects:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$history</span>   <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getHistory</span><span class="p">();</span>
<span class="nv">$cookieJar</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getCookieJar</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>You can also get the objects related to the latest request:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$request</span>  <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">();</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>
<span class="nv">$crawler</span>  <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getCrawler</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>If your requests are not insulated, you can also access the <tt class="docutils literal"><code>Container</code></tt> and
the <tt class="docutils literal"><code>Kernel</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$container</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">();</span>
<span class="nv">$kernel</span>    <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getKernel</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="accessing-the-container">
<h3>Accessing the Container<a class="headerlink" href="#accessing-the-container" title="Permalink to this headline">¶</a></h3>
<p>It's highly recommended that a functional test only tests the Response. But
under certain very rare circumstances, you might want to access some internal
objects to write assertions. In such cases, you can access the dependency
injection container:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$container</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Be warned that this does not work if you insulate the client or if you use an
HTTP layer. For a list of services available in your application, use the
<tt class="docutils literal"><code>container:debug</code></tt> console task.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">If the information you need to check is available from the profiler, use
it instead.</p>
</div></div>
</div>
<div class="section" id="accessing-the-profiler-data">
<h3>Accessing the Profiler Data<a class="headerlink" href="#accessing-the-profiler-data" title="Permalink to this headline">¶</a></h3>
<p>On each request, you can enable the Symfony profiler to collect data about the
internal handling of that request. For example, the profiler could be used to
verify that a given page executes less than a certain number of database
queries when loading.</p>
<p>To get the Profiler for the last request, do the following:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// enable the profiler for the very next request</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">enableProfiler</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/profiler&#39;</span><span class="p">);</span>

<span class="c1">// get the profile</span>
<span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getProfile</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>For specific details on using the profiler inside a test, see the
<a class="reference internal" href="../cookbook/testing/profiling.html"><em>How to use the Profiler in a Functional Test</em></a> cookbook entry.</p>
</div>
<div class="section" id="redirecting">
<h3>Redirecting<a class="headerlink" href="#redirecting" title="Permalink to this headline">¶</a></h3>
<p>When a request returns a redirect response, the client does not follow
it automatically. You can examine the response and force a redirection
afterwards  with the <tt class="docutils literal"><code>followRedirect()</code></tt> method:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">followRedirect</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>If you want the client to automatically follow all redirects, you can
force him with the <tt class="docutils literal"><code>followRedirects()</code></tt> method:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">followRedirects</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="the-crawler">
<span id="book-testing-crawler"></span><span id="index-5"></span><h2>The Crawler<a class="headerlink" href="#the-crawler" title="Permalink to this headline">¶</a></h2>
<p>A Crawler instance is returned each time you make a request with the Client.
It allows you to traverse HTML documents, select nodes, find links and forms.</p>
<div class="section" id="traversing">
<h3>Traversing<a class="headerlink" href="#traversing" title="Permalink to this headline">¶</a></h3>
<p>Like jQuery, the Crawler has methods to traverse the DOM of an HTML/XML
document. For example, the following finds all <tt class="docutils literal"><code>input[type=submit]</code></tt> elements,
selects the last one on the page, and then selects its immediate parent element:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$newCrawler</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;input[type=submit]&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">last</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">parents</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>Many other methods are also available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><code>filter('h1.title')</code></tt></td>
<td>Nodes that match the CSS selector</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><code>filterXpath('h1')</code></tt></td>
<td>Nodes that match the XPath expression</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><code>eq(1)</code></tt></td>
<td>Node for the specified index</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><code>first()</code></tt></td>
<td>First node</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><code>last()</code></tt></td>
<td>Last node</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><code>siblings()</code></tt></td>
<td>Siblings</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><code>nextAll()</code></tt></td>
<td>All following siblings</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><code>previousAll()</code></tt></td>
<td>All preceding siblings</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><code>parents()</code></tt></td>
<td>Returns the parent nodes</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><code>children()</code></tt></td>
<td>Returns children nodes</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><code>reduce($lambda)</code></tt></td>
<td>Nodes for which the callable does not return false</td>
</tr>
</tbody>
</table>
<p>Since each of these methods returns a new <tt class="docutils literal"><code>Crawler</code></tt> instance, you can
narrow down your node selection by chaining the method calls:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$crawler</span>
    <span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">reduce</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Use the <tt class="docutils literal"><code>count()</code></tt> function to get the number of nodes stored in a Crawler:
<tt class="docutils literal"><code>count($crawler)</code></tt></p>
</div></div>
</div>
<div class="section" id="extracting-information">
<h3>Extracting Information<a class="headerlink" href="#extracting-information" title="Permalink to this headline">¶</a></h3>
<p>The Crawler can extract information from the nodes:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// Returns the attribute value for the first node</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">);</span>

<span class="c1">// Returns the node value for the first node</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>

<span class="c1">// Extracts an array of attributes for all nodes</span>
<span class="c1">// (_text returns the node value)</span>
<span class="c1">// returns an array for each element in crawler,</span>
<span class="c1">// each with the value and href</span>
<span class="nv">$info</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;_text&#39;</span><span class="p">,</span> <span class="s1">&#39;href&#39;</span><span class="p">));</span>

<span class="c1">// Executes a lambda for each node and return an array of results</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="links">
<h3>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h3>
<p>To select links, you can use the traversing methods above or the convenient
<tt class="docutils literal"><code>selectLink()</code></tt> shortcut:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Click here&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>This selects all links that contain the given text, or clickable images for
which the <tt class="docutils literal"><code>alt</code></tt> attribute contains the given text. Like the other filtering
methods, this returns another <tt class="docutils literal"><code>Crawler</code></tt> object.</p>
<p>Once you've selected a link, you have access to a special <tt class="docutils literal"><code>Link</code></tt> object,
which has helpful methods specific to links (such as <tt class="docutils literal"><code>getMethod()</code></tt> and
<tt class="docutils literal"><code>getUri()</code></tt>). To click on the link, use the Client's <tt class="docutils literal"><code>click()</code></tt> method
and pass it a <tt class="docutils literal"><code>Link</code></tt> object:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Click here&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>

<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="forms">
<h3>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h3>
<p>Just like links, you select forms with the <tt class="docutils literal"><code>selectButton()</code></tt> method:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$buttonCrawlerNode</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectButton</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Notice that you select form buttons and not forms as a form can have several
buttons; if you use the traversing API, keep in mind that you must look for a
button.</p>
</div></div>
<p>The <tt class="docutils literal"><code>selectButton()</code></tt> method can select <tt class="docutils literal"><code>button</code></tt> tags and submit <tt class="docutils literal"><code>input</code></tt>
tags. It uses several different parts of the buttons to find them:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><code>value</code></tt> attribute value;</li>
<li>The <tt class="docutils literal"><code>id</code></tt> or <tt class="docutils literal"><code>alt</code></tt> attribute value for images;</li>
<li>The <tt class="docutils literal"><code>id</code></tt> or <tt class="docutils literal"><code>name</code></tt> attribute value for <tt class="docutils literal"><code>button</code></tt> tags.</li>
</ul>
<p>Once you have a Crawler representing a button, call the <tt class="docutils literal"><code>form()</code></tt> method
to get a <tt class="docutils literal"><code>Form</code></tt> instance for the form wrapping the button node:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>When calling the <tt class="docutils literal"><code>form()</code></tt> method, you can also pass an array of field values
that overrides the default ones:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span>              <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">,</span>
    <span class="s1">&#39;my_form[subject]&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>And if you want to simulate a specific HTTP method for the form, pass it as a
second argument:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>The Client can submit <tt class="docutils literal"><code>Form</code></tt> instances:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>The field values can also be passed as a second argument of the <tt class="docutils literal"><code>submit()</code></tt>
method:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span>              <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">,</span>
    <span class="s1">&#39;my_form[subject]&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>For more complex situations, use the <tt class="docutils literal"><code>Form</code></tt> instance as an array to set the
value of each field individually:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// Change the value of a field</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">;</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;my_form[subject]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>There is also a nice API to manipulate the values of the fields according to
their type:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// Select an option or a radio</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;France&#39;</span><span class="p">);</span>

<span class="c1">// Tick a checkbox</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;like_symfony&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">tick</span><span class="p">();</span>

<span class="c1">// Upload a file</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;photo&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">upload</span><span class="p">(</span><span class="s1">&#39;/path/to/lucas.jpg&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">You can get the values that will be submitted by calling the <tt class="docutils literal"><code>getValues()</code></tt>
method on the <tt class="docutils literal"><code>Form</code></tt> object. The uploaded files are available in a
separate array returned by <tt class="docutils literal"><code>getFiles()</code></tt>. The <tt class="docutils literal"><code>getPhpValues()</code></tt> and
<tt class="docutils literal"><code>getPhpFiles()</code></tt> methods also return the submitted values, but in the
PHP format (it converts the keys with square brackets notation - e.g.
<tt class="docutils literal"><code>my_form[subject]</code></tt> - to PHP arrays).</p>
</div></div>
</div>
</div>
<div class="section" id="testing-configuration">
<span id="index-6"></span><h2>Testing Configuration<a class="headerlink" href="#testing-configuration" title="Permalink to this headline">¶</a></h2>
<p>The Client used by functional tests creates a Kernel that runs in a special
<tt class="docutils literal"><code>test</code></tt> environment. Since Symfony loads the <tt class="docutils literal"><code>app/config/config_test.yml</code></tt>
in the <tt class="docutils literal"><code>test</code></tt> environment, you can tweak any of your application's settings
specifically for testing.</p>
<p>For example, by default, the swiftmailer is configured to <em>not</em> actually
deliver emails in the <tt class="docutils literal"><code>test</code></tt> environment. You can see this under the <tt class="docutils literal"><code>swiftmailer</code></tt>
configuration option:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1"># app/config/config_test.yml</span>

<span class="c1"># ...</span>
<span class="l-Scalar-Plain">swiftmailer</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">disable_delivery</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config_test.xml --&gt;</span>
<span class="nt">&lt;container&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;swiftmailer:config</span> <span class="na">disable-delivery=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// app/config/config_test.php</span>

<span class="c1">// ...</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;swiftmailer&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;disable_delivery&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>You can also use a different environment entirely, or override the default
debug mode (<tt class="docutils literal"><code>true</code></tt>) by passing each as options to the <tt class="docutils literal"><code>createClient()</code></tt>
method:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;environment&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my_test_env&#39;</span><span class="p">,</span>
    <span class="s1">&#39;debug&#39;</span>       <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>If your application behaves according to some HTTP headers, pass them as the
second argument of <tt class="docutils literal"><code>createClient()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;HTTP_HOST&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;en.example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HTTP_USER_AGENT&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MySuperBrowser/1.0&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>You can also override HTTP headers on a per request basis:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;HTTP_HOST&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;en.example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HTTP_USER_AGENT&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MySuperBrowser/1.0&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">The test client is available as a service in the container in the <tt class="docutils literal"><code>test</code></tt>
environment (or wherever the <a class="reference internal" href="../reference/configuration/framework.html#reference-framework-test"><em>framework.test</em></a>
option is enabled). This means you can override the service entirely
if you need to.</p>
</div></div>
<div class="section" id="phpunit-configuration">
<span id="index-7"></span><h3>PHPUnit Configuration<a class="headerlink" href="#phpunit-configuration" title="Permalink to this headline">¶</a></h3>
<p>Each application has its own PHPUnit configuration, stored in the
<tt class="docutils literal"><code>phpunit.xml.dist</code></tt> file. You can edit this file to change the defaults or
create a <tt class="docutils literal"><code>phpunit.xml</code></tt> file to tweak the configuration for your local machine.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Store the <tt class="docutils literal"><code>phpunit.xml.dist</code></tt> file in your code repository, and ignore the
<tt class="docutils literal"><code>phpunit.xml</code></tt> file.</p>
</div></div>
<p>By default, only the tests stored in &quot;standard&quot; bundles are run by the
<tt class="docutils literal"><code>phpunit</code></tt> command (standard being tests in the <tt class="docutils literal"><code>src/*/Bundle/Tests</code></tt> or
<tt class="docutils literal"><code>src/*/Bundle/*Bundle/Tests</code></tt> directories) But you can easily add more
directories. For instance, the following configuration adds the tests from
the installed third-party bundles:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">&lt;!-- hello/phpunit.xml.dist --&gt;</span>
<span class="nt">&lt;testsuites&gt;</span>
    <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Project Test Suite&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>To include other directories in the code coverage, also edit the <tt class="docutils literal"><code>&lt;filter&gt;</code></tt>
section:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;whitelist&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;exclude&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/exclude&gt;</span>
    <span class="nt">&lt;/whitelist&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="learn-more">
<h2>Learn more<a class="headerlink" href="#learn-more" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../components/dom_crawler.html"><em>The DomCrawler Component</em></a></li>
<li><a class="reference internal" href="../components/css_selector.html"><em>The CssSelector Component</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/http_authentication.html"><em>How to simulate HTTP Authentication in a Functional Test</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/insulating_clients.html"><em>How to test the Interaction of several Clients</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/profiling.html"><em>How to use the Profiler in a Functional Test</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/bootstrap.html"><em>How to customize the Bootstrap Process before running Tests</em></a></li>
</ul>
</div>
</div>

    </div>

            <div class="navigation">
                            <a accesskey="P" title="Databases and Propel" href="propel.html">
                    &laquo;&nbsp;Databases and Propel
                </a>
                        <span class="separator">|</span>                            <a accesskey="N" title="Validation" href="validation.html">
                    Validation&nbsp;&raquo;
                </a>
                    </div>

            <div class="box_hr"><hr /></div>

                                                                                </div>
                                                            </div>
                        
                        
                                                    <div class="box_relative_content">
    <div class="relative_content_box_columns clear_fix">
        <div class="column_01">
            <h2 class="title_05">NEWS FROM THE BLOG</h2>

<ul class="event_list">
            <li>
            <h3>
                <a href="/blog/symfony-2-3-schedule-update">
                    Symfony 2.3 schedule update<br />
                    <span class="place_date">April 30, 2013</span>
                </a>
            </h3>
        </li>
            <li>
            <h3>
                <a href="/blog/a-week-of-symfony-330-22-28-april-2013">
                    A week of symfony #330 (22-&gt;28 April 2013)<br />
                    <span class="place_date">April 28, 2013</span>
                </a>
            </h3>
        </li>
            <li>
            <h3>
                <a href="/blog/new-in-symfony-2-3-new-validators">
                    New in Symfony 2.3: New validators<br />
                    <span class="place_date">April 25, 2013</span>
                </a>
            </h3>
        </li>
    </ul>

<div class="link_01">
    <a href="/blog/" class="png_fix">Visit Symfony's blog</a>
</div>
        </div>

        <div class="column_02">
                        <h2 class="title_05">IN THE NEWS</h2>


<div class="upcoming_event clear_fix">
    <div>
        <a href="http://portland2013.live.symfony.com/" target="_blank">
            <img style="width: 100px" src="http://live.symfony.com/bundles/sensiosymfonylive/images/landing/sfl_portland.png" class="png_fix" alt="The Symfony Live Conference Portland 2013" />
        </a>
    </div>

    <div style="margin-top: 13px">
        <h3 style="font-size: 13px; font-family: 'Lucida Sans Unicode', 'Lucida Grande', Verdana, Arial, Helvetica, sans-serif">Announcing the next Symfony Live Conference 2013 in Portland</h3>
        <div style="margin-top: 5px">
            <a href="http://portland2013.live.symfony.com/registration/" class="non_extensible_button button_01">    <span class="border_l png_fix">
        <span class="border_r png_fix">
            <span class="btn_bg png_fix">
                REGISTER TODAY
            </span>
        </span>
    </span>
</a>
        </div>
    </div>
</div>

                    </div>

        <div class="column_03">
            <h2 class="title_05">UPCOMING TRAINING SESSIONS</h2>

<ul class="event_list">
        <li>
        <a href="http://trainings.sensiolabs.com/en/training/symfony-certification">
            Symfony2 Framework Certification
            <br />
            <span class="place_date">Cologne - 2013-04-26</span>
        </a>
    </li>
        <li>
        <a href="http://trainings.sensiolabs.com/en/training/getting-started-with-symfony2">
            Getting Started with Symfony2
            <br />
            <span class="place_date">Paris - 2013-05-13</span>
        </a>
    </li>
        <li>
        <a href="http://trainings.sensiolabs.com/en/training/getting-started-with-symfony2">
            Getting Started with Symfony2
            <br />
            <span class="place_date">Cologne - 2013-05-13</span>
        </a>
    </li>
    </ul>

<div class="link_01">
    <a href="http://trainings.sensiolabs.com/" class="png_fix">View all sessions</a>
</div>
        </div>
    </div>
</div>
                        
                    </div>
                            </div>

            
<div class="footer">
    <div class="content">
        <h2 class="title_02">
            <img src="/images/common/logo/logo_sf.png" alt="sf - Symfony" class="illustration_logo_footer png_fix"/> is a trademark of Fabien Potencier. All rights reserved.
        </h2>

        <div class="box_menu_footer clear_fix">
            <div class="menu_footer first">
                <h3 class="title_03"><a href="/what-is-symfony">What is Symfony?</a></h3>
                <ul class="list_menu_footer">
                    <li class="first"><a href="/symfony-at-a-glance">Symfony at a Glance</a></li>
<li><a href="/symfony-in-five-minutes">Symfony in 5 Minutes</a></li>
<li><a href="/elevator-pitches">Elevator Pitches</a></li>
<li><a href="/blog/category/case-studies">Case Studies</a></li>
<li><a href="/doc/current/contributing/community/releases.html">Versioning Policy</a></li>
<li><a href="/doc/current/contributing/community/releases.html#long-term-support-releases">Long Term Support</a></li>
<li><a href="/doc/current/contributing/code/security.html">Security Policy</a></li>
<li class="last"><a href="/doc/current/contributing/code/license.html">License</a></li>
                </ul>
            </div>

            <div class="menu_footer">
                <h3 class="title_03"><a href="/get_started">Get Started</a></h3>
                <ul class="list_menu_footer">
                    <li class="first"><a href="/download">Download Symfony</a></li>
<li><a href="/distributions">Symfony Distributions</a></li>
<li><a href="/components">Symfony Components</a></li>
<li><a href="/doc/current/quick_tour/the_big_picture.html">Quick Tour</a></li>
<li class="last"><a href="/legacy">symfony1 Legacy</a></li>
                </ul>

                <h3 class="title_03"><a href="/doc/current/index.html">Learn Symfony</a></h3>
                <ul class="list_menu_footer">
                    <li class="first selected"><a href="/doc/current/book/index.html">The Book</a></li>
<li><a href="/doc/current/cookbook/index.html">The Cookbook</a></li>
<li><a href="/doc/current/components/index.html">The Components</a></li>
<li><a href="/doc/current/reference/index.html">Reference</a></li>
<li><a href="/doc/current/glossary.html">Glossary</a></li>
<li><a href="/doc/current/genindex.html">Index</a></li>
<li><a href="/doc/current/bundles/index.html">Bundles</a></li>
<li><a href="/doc/master/cmf/index.html">Symfony CMF</a></li>
<li><a href="/doc/master/contributing/code/security.html#security-advisories">Security Advisories</a></li>
<li><a href="/legacy/doc">Docs for symfony 1.x</a></li>
<li><a href="/doc/current/contributing/index.html">Contributing</a></li>
<li><a href="/talks">Talks</a></li>
<li><a href="http://trainings.sensiolabs.com/">Trainings</a></li>
<li class="last"><a href="http://books.sensiolabs.com">Books</a></li>
                </ul>
            </div>

            <div class="menu_footer">
                <h3 class="title_03"><a href="/marketplace">Marketplace</a></h3>
                <ul class="list_menu_footer">
                </ul>

                <h3 class="title_03"><a href="/community">Community</a></h3>
                <ul class="list_menu_footer">
                    <li><a href="https://connect.sensiolabs.com/">SensioLabs Connect</a></li>
<li><a href="/irc">IRC channel</a></li>
<li><a href="/mailing-lists">Mailing lists</a></li>

<li><a href="http://forum.symfony-project.org/">Forum</a></li>
<li><a href="/doc/current/contributing/index.html">How to be involved</a></li>
                </ul>
            </div>

            <div class="menu_footer">
                <h3 class="title_03"><a href="/services">Services</a></h3>
                <ul class="list_menu_footer">
                    <li><a href="/services/list">Our services</a></li>
<li><a href="/services/guide#before">Starting a new project</a></li>
<li><a href="/services/guide#during">Struggling with your project</a></li>
<li><a href="http://sensiolabs.com/en/support/sensiolabs_support.html">Support</a></li>
<li><a href="/services/request">Contact us</a></li>
                </ul>
            </div>

            <div class="menu_footer">
                <h3 class="title_03"><a href="/blog/">Blog</a></h3>
                <ul class="list_menu_footer">
                    <li><a href="/events/"><em>Community Events</em></a></li>

    <li><a href="/blog/category/a-week-of-symfony">A week of symfony</a></li>
    <li><a href="/blog/category/call-the-expert">Call the expert</a></li>
    <li><a href="/blog/category/case-studies">Case studies</a></li>
    <li><a href="/blog/category/community">Community</a></li>
    <li><a href="/blog/category/documentation">Documentation</a></li>
    <li><a href="/blog/category/living-on-the-edge">Living on the edge</a></li>
    <li><a href="/blog/category/plugins">Plugins</a></li>
    <li><a href="/blog/category/releases">Releases</a></li>
    <li><a href="/blog/category/security-advisories">Security Advisories</a></li>
    <li><a href="/blog/category/tutorials">Tutorials</a></li>
                </ul>
            </div>

            <div class="menu_footer">
                <h3 class="title_03"><a href="/about">About</a></h3>
                <ul class="list_menu_footer">
                    <li><a href="http://www.sensiolabs.com/">Sensio Labs</a></li>
<li><a href="/contributors">Contributors</a></li>
<li><a href="/trademark">Trademark &amp; Logo Policy</a></li>
<li><a href="/logo">Logo</a></li>
<li><a href="http://sensiolabs.com/recrutement/rejoignez_nous.html">Jobs</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
        </div>

        <script type="text/javascript">
            (function(w, d, s) {
                function go() {
                    var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
                        if (d.getElementById(id)) {return;}
                        js = d.createElement(s); js.src = url; js.id = id;
                        fjs.parentNode.insertBefore(js, fjs);
                    };
                    load('https://connect.sensiolabs.com/sln.js?customize_url=http://symfony.com/sln_customiser.js', 'sln_bar');
                }
                if (w.addEventListener) { w.addEventListener("load", go, false); }
                else if (w.attachEvent) { w.attachEvent("onload",go); }
            } (window, document, 'script'));
        </script>
                    </body>
</html>
